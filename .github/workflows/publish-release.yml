name: Publish Release

on:
  push:
    branches:
      - "release/*"
# on:
#   push:
#     branches:
#       - "*"
#       - "v/*"

jobs:
  check_project_builds:
    name: Publish a new version
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Check Version
        id: version
        uses: cpdevtools/action-versions@latest
        with:
          failInvalidCanCreate: true

      - name: Install Node & Dependencies
        uses: cpdevtools/common-github-workflows/.github/actions/node-setup-pnpm@v0.0.15

      - name: Build Project
        uses: cpdevtools/common-github-workflows/.github/actions/run-build@v0.0.15

      - name: Copy to release directory
        run: |
          rm -Rf release
          cp -r dist/webflow-ng-availability-calendar/* release

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4

      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          name: Release v${{ steps.version.outputs.targetVersion }}
          tag_name: v${{ steps.version.outputs.targetVersion }}
          body: |
            Generated Release v${{ steps.version.outputs.targetVersion }}
          draft: "false"
          prerelease: ${{ steps.version.outputs.targetIsPrerelease }}
          files: |
            dist/webflow-ng-availability-calendar/main.js
            dist/webflow-ng-availability-calendar/polyfills.js
            dist/webflow-ng-availability-calendar/styles.css
            dist/webflow-ng-availability-calendar/3rdpartylicenses.txt

      - name: Create tags
        uses: cpdevtools/action-versions@latest
        with:
          createTags: all
